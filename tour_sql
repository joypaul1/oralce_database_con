/* Formatted on 26/06/2025 3:37:09 PM (QP5 v5.287) */
CREATE OR REPLACE TRIGGER DEVELOPERS.RML_HR_EMP_TOUR_AT_ACTUAL_PRICE
   BEFORE UPDATE OF TOUR_END_TIME
   ON DEVELOPERS.RML_HR_EMP_TOUR
   FOR EACH ROW
DECLARE
   AT_ACTUAL_PRICE       NUMBER := 0;
   IS_NIGHT_STAY         BOOLEAN := FALSE;
   IS_STAY_WITH_FAMILY   BOOLEAN := FALSE;
   TOTAL_DURATION_TIME   VARCHAR2 (100);
   DESIGNATION           VARCHAR2 (100);
BEGIN

    -- GET INFORMATION ABOUT THIS TOUR
   SELECT NIGHT_STAY,
          STAY_WITH_FAMILY,
          TOTAL_DURATION_TIME,
          DESIGNATION
     INTO IS_NIGHT_STAY,
          IS_STAY_WITH_FAMILY,
          TOTAL_DURATION_TIME,
          DESIGNATION
     FROM DEVELOPERS.RML_HR_EMP_TOUR
    WHERE ID = :NEW.ID;
       
    -- Example: Set AT_ACTUAL_PRICE based on some logic
   
    
    
END;
/



DECLARE
   TOUR_BILL               NUMBER := 0;
   DAILY_ALLOWANCE         NUMBER := 0;
   TOTAL_BILL              NUMBER := 0;
   SHORT_FORM_DESIGNATION  VARCHAR2(10);
BEGIN
   SELECT TOUR_BILL, DAILY_ALLOWANCE, SHORT_FORM_DESIGNATION
     INTO TOUR_BILL, DAILY_ALLOWANCE, SHORT_FORM_DESIGNATION
     FROM TOUR_CONFIGURATION
    WHERE STATUS = 1 AND LOWER(DESIGNATION) = LOWER('EXECUTIVE');

   IF TOUR_BILL > 0 THEN 
      TOTAL_BILL := TOUR_BILL + DAILY_ALLOWANCE;
   END IF;

   DBMS_OUTPUT.PUT_LINE('TOTAL BILL: ' || TOTAL_BILL);

EXCEPTION
   WHEN NO_DATA_FOUND THEN
      DBMS_OUTPUT.PUT_LINE('No data found for EXECUTIVE');
   WHEN OTHERS THEN
      DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
END;
/
