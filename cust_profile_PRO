
INSERT INTO CUSTOMER_CODE_PROFILE.CUSTOMER_PROFILE (CUST_NAME, CUST_MOBILE, CUST_ADDRESS, CUST_CODE)
SELECT CUSTOMER_NAME, CUSTOMER_MOBILE_NO, PARTY_ADDRESS, PARTYCDE
FROM (
    SELECT CUSTOMER_NAME, CUSTOMER_MOBILE_NO, PARTY_ADDRESS, PARTYCDE,
           ROW_NUMBER() OVER (PARTITION BY PARTYCDE ORDER BY ROWID DESC) AS rn
    FROM DEVELOPERS.EMI_ERP_VIEW_DATA
    WHERE PARTYCDE IS NOT NULL
)
WHERE rn = 1
  AND PARTYCDE NOT IN (
      SELECT CUST_CODE FROM CUSTOMER_CODE_PROFILE.CUSTOMER_PROFILE
  );


INSERT INTO CUSTOMER_CODE_PROFILE.CODE_WISE_STATUS (CUST_CODE, REF_CODE, PAYMENT_MODE, CODE_STATUS,NUMBER_OF_DUE)
SELECT  PARTYCDE,REF_CODE, SALES_TYPE, STATUS, NUMBER_OF_DUE
FROM (
    SELECT PARTYCDE,REF_CODE, SALES_TYPE, STATUS, NUMBER_OF_DUE,
           ROW_NUMBER() OVER (PARTITION BY PARTYCDE ORDER BY ROWID DESC) AS rn
    FROM DEVELOPERS.EMI_ERP_VIEW_DATA
    WHERE PARTYCDE IS NOT NULL
)
WHERE rn = 1
  AND PARTYCDE NOT IN (
      SELECT CUST_CODE FROM CUSTOMER_CODE_PROFILE.CODE_WISE_STATUS;
  );


/// --insert data into CUSTOMER_CODE_PROFILE.CODE_WISE_STATUS table lat and lang from DEVELOPERS.RML_COLL_CUST_VISIT table

MERGE INTO CUSTOMER_CODE_PROFILE.CODE_WISE_STATUS dst
USING (
    SELECT *
    FROM (
        SELECT cws.REF_CODE,
               v.LATITUDE,
               v.LONGITUDE,
               ROW_NUMBER() OVER (ORDER BY cws.REF_CODE) AS rn
        FROM CUSTOMER_CODE_PROFILE.CODE_WISE_STATUS cws
        JOIN (
            SELECT REF_ID, LATITUDE, LONGITUDE,
                   ROW_NUMBER() OVER (PARTITION BY REF_ID ORDER BY ID DESC) AS rid
            FROM DEVELOPERS.RML_COLL_CUST_VISIT
        ) v ON v.REF_ID = cws.REF_CODE
        WHERE v.rid = 1
    )
    WHERE rn > 25000 AND rn <= 30000
) src
ON (dst.REF_CODE = src.REF_CODE)
WHEN MATCHED THEN
UPDATE SET dst.LAT = src.LATITUDE,
           dst.LANG = src.LONGITUDE;


select count (*) from CODE_WISE_STATUS;
--For example, if you want to skip 20 rows and take 10 rows (rows 21â€“30): WHERE rn > 20 AND rn <= 30
